<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Brothers EGY - Contract System v60.0 (Golden Stable)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- SCREEN ONLY CSS --- */
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #eef2f5; margin: 0; padding: 20px; color: #333; }
        
        .control-panel {
            max-width: 1200px; margin: 0 auto; background: white; padding: 25px;
            border-radius: 10px; border-top: 5px solid #04509D; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Grid Layouts for Inputs */
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        
        label { display: block; font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; color: #555; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        .section-head { font-weight: bold; border-bottom: 2px solid #eee; padding-bottom: 5px; margin: 20px 0 10px 0; color: #04509D; }
        
        .btn-gen { 
            background: #04509D; color: white; width: 100%; padding: 15px; 
            font-size: 18px; font-weight: bold; border: none; cursor: pointer; border-radius: 5px;
            margin-top: 20px;
        }
        .btn-gen:hover { background: #033a75; }

        /* --- PRINT CSS (THE CONTRACT LAYOUT) --- */
        #print-area { display: none; } /* Hidden on screen */

        @media print {
            body { background: white; margin: 0; padding: 0; }
            .control-panel { display: none !important; } /* Hide Inputs */
            #print-area { display: block !important; } /* Show Contract */
            @page { margin: 0; size: A4; }

            .a4-page {
                width: 210mm; min-height: 296mm; margin: 0 auto; background: white;
                padding: 10mm 12mm; position: relative; box-sizing: border-box;
                font-family: 'Helvetica', 'Arial', sans-serif; font-size: 9.5pt; line-height: 1.35; color: #000;
                display: flex; flex-direction: column; page-break-after: always;
            }
            
            .watermark {
                position: absolute; top: 50%; left: 50%; width: 70%; 
                transform: translate(-50%, -50%) rotate(-30deg);
                opacity: 0.06; pointer-events: none; z-index: 0;
            }
            .watermark img { width: 100%; height: auto; }

            .page-content { position: relative; z-index: 1; flex-grow: 1; display: flex; flex-direction: column; }

            /* Header */
            .doc-head { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #04509D; padding-bottom: 8px; margin-bottom: 12px; }
            .logo { height: 60px; }
            .hq-info { text-align: right; font-size: 8pt; color: #333; line-height: 1.3; }
            
            /* Tables */
            table.pt { width: 100%; border-collapse: collapse; margin-bottom: 12px; font-size: 9pt; }
            table.pt th { background: #f0f0f0; text-align: left; padding: 4px 6px; border: 1px solid #888; font-weight: bold; }
            table.pt td { border: 1px solid #888; padding: 4px 6px; vertical-align: top; }
            
            .box-section { border: 1px solid #000; padding: 8px; margin-bottom: 12px; position: relative; }
            .bs-title { 
                background: #000; color: white; display: inline-block; padding: 2px 8px; 
                font-weight: bold; font-size: 8pt; position: absolute; top: -10px; left: -1px;
                text-transform: uppercase; 
            }

            /* Terms */
            .terms-grid { font-size: 8pt; text-align: justify; column-count: 2; column-gap: 25px; line-height: 1.25; flex-grow: 1; }
            .term-p { margin-bottom: 8px; break-inside: avoid; }
            .term-h { 
                font-weight: 800; text-transform: uppercase; display: block; margin-bottom: 2px; 
                border-bottom: 1px solid #ccc; padding-bottom: 1px; font-size: 8.5pt; color: #04509D; 
            }
            
            /* Inspection */
            .insp-img-box { width: 100%; height: 260px; border: 1px solid #ccc; margin: 5px 0; display: flex; align-items: center; justify-content: center; background: #fff; }
            .insp-img-box img { width: 99%; height: 99%; object-fit: contain; }
            
            .insp-grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; font-size: 8pt; margin-bottom: 10px; }
            .insp-col { display: flex; flex-direction: column; gap: 2px; border: 1px solid #ccc; padding: 5px; }
            .insp-col h4 { margin: 0 0 5px 0; font-size: 8.5pt; text-transform: uppercase; border-bottom: 1px solid; padding-bottom: 2px; }
            .insp-item { display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
            .insp-check { font-family: monospace; font-size: 10pt; border:1px solid #ccc; width: 30px; text-align: center; }
            
            /* Receipts */
            .receipts-wrapper { display: flex; flex-direction: column; gap: 20px; height: 100%; margin-top: 10px; justify-content: flex-start; }
            .receipt { border: 2px solid #333; padding: 15px 20px; display: flex; flex-direction: column; background: white; position: relative; margin-bottom: 15px; page-break-inside: avoid; min-height: 250px; }
            .r-header { border-bottom: 3px double #04509D; padding-bottom: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
            .r-logo { height: 35px; }
            .r-title { font-weight: 900; font-size: 12pt; color: #04509D; text-transform: uppercase; }
            .r-copy { font-size: 9pt; background: #eee; padding: 4px 8px; border: 1px solid #ccc; font-weight: bold; }
            .r-body { flex: 1; display: flex; flex-direction: column; gap: 6px; font-size: 10pt; }
            .r-row { display: flex; justify-content: space-between; border-bottom: 1px dotted #999; padding-bottom: 4px; }
            .r-footer { margin-top: auto; padding-top: 15px; text-align: right; }
            .r-sign { margin-top: 5px; font-size: 9pt; text-align: left; font-weight: bold; }
            .receipt:after { content:"✂"; position:absolute; bottom:-25px; left:50%; background:white; padding:0 5px; font-size:14px; }
            
            .sig-block { margin-top: 40px; border-top: 1px solid #000; padding-top: 5px; width: 40%; text-align: center; font-weight: bold; }
        }
    </style>
</head>
<body>

<div class="control-panel">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 style="margin:0; color:#04509D;">CONTRACT GENERATOR v60.0</h2>
        <div>
            <b>USD:</b> <input type="number" id="ex_usd" value="50.00" style="width:70px">
            <b>EUR:</b> <input type="number" id="ex_eur" value="54.00" style="width:70px">
        </div>
    </div>

    <div class="section-head">1. Contract Details</div>
    <div class="grid-3">
        <div><label>Branch</label><select id="branch"><option>Hurghada</option><option>Alexandria (HQ)</option><option>Cairo</option></select></div>
        <div><label>Mode</label><select id="mode"><option value="Daily">Daily (Short Term)</option><option value="Monthly">Monthly (Long Term)</option></select></div>
        <div><label>Type</label><select id="type"><option>New</option><option>Extension</option></select></div>
    </div>

    <div class="section-head">2. Vehicle (Guaranteed List)</div>
    <div class="grid-2">
        <div><label>Select Car</label>
            <select id="car_select" onchange="fillCar()">
                <option value="">-- Select Car --</option>
                <option value="Haval Jolion" data-p="ب ا ن | 2 6 4 9" data-v="606889" data-m="21499022758">33 - Haval Jolion (2022)</option>
                <option value="Chevrolet Aveo" data-p="ع د ب | 8 2 6 3" data-v="E009927" data-m="191160037">38 - Chevrolet Aveo (2020)</option>
                <option value="Hyundai Tucson" data-p="ه س ب | 4 2 6 3" data-v="KMHJE81BGN" data-m="G4FPNU539488">47 - Hyundai Tucson (2022)</option>
                <option value="Jetour X90" data-p="ف ص ب | 2 9 1 5" data-v="LVTDB21B5TH013984" data-m="SH02227">48 - Jetour X90 Plus (2026)</option>
                <option value="MG ZS" data-p="ق ه س | 5 3 6 5" data-v="LSJW74U61SZ027362" data-m="3050131">34 - MG ZS (2025)</option>
                <option value="Nissan Sunny" data-p="ل ه ب | 7 3 5 1" data-v="137137" data-m="798285">40 - Nissan Sunny (2023)</option>
                <option value="Renault Duster" data-p="د ع ص | 5 9 4 9" data-v="VFIHJD208SA107071" data-m="50063">43 - Renault Duster (2025)</option>
            </select>
        </div>
        <div><label>Manual Model</label><input type="text" id="c_model"></div>
    </div>
    <input type="hidden" id="c_plate"><input type="hidden" id="c_vin"><input type="hidden" id="c_motor">

    <div class="grid-4">
        <div><label>KM Out</label><input type="number" id="c_km" value="0"></div>
        <div><label>Fuel</label><select id="c_fuel"><option>Full</option><option>3/4</option><option>1/2</option><option>1/4</option></select></div>
        <div><label>Rent Rate (EGP)</label><input type="number" id="rate_rent" value="0"></div>
        <div><label>Ins Rate (EGP)</label><input type="number" id="rate_ins" value="0"></div>
    </div>

    <div class="section-head">3. Client & Dates</div>
    <div class="grid-3">
        <div><label>Client Name</label><input type="text" id="cl_name"></div>
        <div><label>Passport / ID</label><input type="text" id="cl_id"></div>
        <div><label>Phone</label><input type="text" id="cl_phone" value="+20"></div>
    </div>
    <div class="grid-2">
        <div><label>Pickup Date</label><input type="datetime-local" id="d_start"></div>
        <div><label>Dropoff Date</label><input type="datetime-local" id="d_end"></div>
    </div>
    <div class="grid-2">
        <div><label>Pickup Location</label><input type="text" id="l_start" value="Hotel Azur"></div>
        <div><label>Dropoff Location</label><input type="text" id="l_end" value="Airport Hurghada"></div>
    </div>

    <div class="section-head">4. Money & Payments</div>
    <div class="grid-3">
        <div><label>Delivery Fee</label><input type="number" id="fee_del" value="0"></div>
        <div><label>Pickup Fee</label><input type="number" id="fee_pick" value="0"></div>
        <div><label>Required Deposit</label><input type="number" id="req_dep" value="5000"></div>
    </div>
    
    <div style="background:#f0f0f0; padding:15px; border-radius:8px; margin-bottom:15px;">
        <label>RENT PAID (NOW)</label>
        <div class="grid-4">
            <input type="number" id="p_r_egp" placeholder="EGP">
            <input type="number" id="p_r_usd" placeholder="USD">
            <input type="number" id="p_r_eur" placeholder="EUR">
            <input type="number" id="p_r_card" placeholder="Card">
        </div>
        <label style="margin-top:10px;">DEPOSIT HELD</label>
        <div class="grid-4">
            <input type="number" id="p_d_egp" placeholder="EGP">
            <input type="number" id="p_d_usd" placeholder="USD">
            <input type="number" id="p_d_eur" placeholder="EUR">
            <input type="number" id="p_d_card" placeholder="Card">
        </div>
    </div>

    <div class="grid-2">
        <div><label>Insurance</label>
            <select id="ins_type">
                <option value="Basic">Basic (100% Client Liability)</option>
                <option value="Intermediate">Intermediate (70% Client / 30% Co)</option>
                <option value="Full">Full Protection (Zero Liability)</option>
            </select>
        </div>
        <div><label>Extras</label>
            <div style="font-size:12px;">
                <input type="checkbox" id="add_km"> Unlimited KM (500)<br>
                <input type="checkbox" id="add_dr"> Extra Driver (250)
            </div>
        </div>
    </div>

    <button class="btn-gen" onclick="generate()">GENERATE PDF</button>
</div>

<div id="print-area"></div>

<script>
    function fillCar() {
        var sel = document.getElementById('car_select');
        var opt = sel.options[sel.selectedIndex];
        if(opt.value !== "") {
            document.getElementById('c_model').value = opt.value;
            document.getElementById('c_plate').value = opt.getAttribute('data-p');
            document.getElementById('c_vin').value = opt.getAttribute('data-v');
            document.getElementById('c_motor').value = opt.getAttribute('data-m');
        }
    }

    function getVal(id) { return document.getElementById(id).value; }
    function getNum(id) { return parseFloat(document.getElementById(id).value) || 0; }

    function generate() {
        var cid = "BE-" + new Date().getFullYear().toString().substr(-2) + "-" + Math.floor(Math.random()*9000);
        var today = new Date().toLocaleDateString();
        
        var ex_usd = getNum('ex_usd');
        var ex_eur = getNum('ex_eur');
        var mode = getVal('mode');
        
        var d1 = new Date(getVal('d_start'));
        var d2 = new Date(getVal('d_end'));
        var days = Math.ceil((d2 - d1) / (1000 * 60 * 60 * 24));
        if(isNaN(days) || days < 1) days = 1;
        
        var months = 1;
        if(mode === 'Monthly') months = Math.ceil(days / 30);

        var r_rate = getNum('rate_rent');
        var i_rate = getNum('rate_ins');
        var fee_d = getNum('fee_del');
        var fee_p = getNum('fee_pick');
        
        // Add-ons
        var adds = 0;
        if(document.getElementById('add_km').checked) adds += 500;
        if(document.getElementById('add_dr').checked) adds += 250;

        var baseRent = (mode === 'Monthly') ? (r_rate * months) : ((r_rate + adds) * days);
        var totalIns = (mode === 'Monthly') ? (i_rate * days) : (i_rate * days);
        var totalDue = baseRent + totalIns + fee_d + fee_p;

        // Payments
        var r_paid_val = getNum('p_r_egp') + (getNum('p_r_usd') * ex_usd) + (getNum('p_r_eur') * ex_eur) + getNum('p_r_card');
        var d_paid_val = getNum('p_d_egp') + (getNum('p_d_usd') * ex_usd) + (getNum('p_d_eur') * ex_eur) + getNum('p_d_card');
        
        var r_str = "";
        if(getNum('p_r_egp')>0) r_str += getVal('p_r_egp') + " EGP ";
        if(getNum('p_r_usd')>0) r_str += getVal('p_r_usd') + " USD ";
        if(getNum('p_r_eur')>0) r_str += getVal('p_r_eur') + " EUR ";
        if(getNum('p_r_card')>0) r_str += getVal('p_r_card') + " Card ";
        if(r_str === "") r_str = "0";

        var d_str = "";
        if(getNum('p_d_egp')>0) d_str += getVal('p_d_egp') + " EGP ";
        if(getNum('p_d_usd')>0) d_str += getVal('p_d_usd') + " USD ";
        if(getNum('p_d_eur')>0) d_str += getVal('p_d_eur') + " EUR ";
        if(getNum('p_d_card')>0) d_str += getVal('p_d_card') + " Card ";
        if(d_str === "") d_str = "0";

        var pending = totalDue - r_paid_val;

        // BUILD HTML
        var html = '';

        // PAGE 1
        html += `
        <div class="a4-page">
            <div class="watermark"><img src="https://brothersegy.com/wp-content/uploads/2026/02/12345.png"></div>
            <div class="page-content">
                <div class="doc-head">
                    <img src="https://brothersegy.com/wp-content/uploads/2025/07/22wdd.jpg" class="logo">
                    <div style="text-align:center"><h2>CAR RENTAL AGREEMENT</h2><b>${cid}</b><br>${getVal('type') === 'Extension' ? '(EXTENSION)' : ''}</div>
                    <div class="hq-info"><b>BROTHERS EGY HQ</b><br>Alexandria<br>Tax: 589-464-418</div>
                </div>

                <div class="box-section"><span class="bs-title">PARTIES</span>
                    <table class="pt" style="margin:0">
                        <tr><td width="30%"><b>LESSOR</b><br>El Alakhua El Mutahidun<br>${getVal('branch')}</td>
                        <td><b>LESSEE</b><br>Name: ${getVal('cl_name')}<br>ID: ${getVal('cl_id')}<br>Phone: ${getVal('cl_phone')}</td></tr>
                    </table>
                </div>

                <div class="box-section"><span class="bs-title">VEHICLE</span>
                    <table class="pt">
                        <tr><th>Model</th><td>${getVal('c_model')}</td><th>Plate</th><td><b>${getVal('c_plate')}</b></td><th>KM Out</th><td>${getVal('c_km')}</td></tr>
                        <tr><th>VIN</th><td>${getVal('c_vin')}</td><th>Motor</th><td>${getVal('c_motor')}</td><th>Fuel</th><td>${getVal('c_fuel')}</td></tr>
                        <tr><th>Pickup</th><td>${getVal('d_start').replace('T',' ')}<br>${getVal('l_start')}</td><th>Dropoff</th><td>${getVal('d_end').replace('T',' ')}<br>${getVal('l_end')}</td><th>Duration</th><td>${days} Days</td></tr>
                    </table>
                </div>

                <div class="box-section"><span class="bs-title">FINANCIAL BREAKDOWN</span>
                    <table class="pt">
                        <tr><th>Description</th><th>Calculation</th><th>Amount (EGP)</th></tr>
                        <tr><td>Base Rent</td><td>${getVal('rate_rent')} x ${mode==='Monthly' ? months + ' Mo' : days + ' Days'}</td><td>${baseRent}</td></tr>
                        ${i_rate > 0 ? `<tr><td>Insurance</td><td>${i_rate} x ${days} Days</td><td>${totalIns}</td></tr>` : ''}
                        ${fee_d > 0 ? `<tr><td>Delivery Fee</td><td>${getVal('l_start')}</td><td>${fee_d}</td></tr>` : ''}
                        ${fee_p > 0 ? `<tr><td>Pickup Fee</td><td>${getVal('l_end')}</td><td>${fee_p}</td></tr>` : ''}
                        <tr><td colspan="2" align="right"><b>TOTAL CONTRACT VALUE</b></td><td><b>${totalDue} EGP</b></td></tr>
                    </table>
                    <div style="background:#eee; padding:5px; border:1px solid #000; text-align:center;">
                        <b>PAID NOW:</b> ${r_str} <br>
                        <b>PENDING:</b> <span style="color:${pending>0?'red':'green'}">${pending} EGP</span>
                    </div>
                </div>

                <div style="border:2px solid orange; padding:5px; margin:10px 0; font-weight:bold;">
                    DEPOSIT HELD: ${d_str} (${Math.round(d_paid_val)} EGP Value)
                </div>

                <table class="sig-block" style="width:100%"><tr><td>LESSOR SIGNATURE</td><td>LESSEE SIGNATURE</td></tr></table>
            </div>
        </div>`;

        // PAGE 2
        html += `
        <div class="a4-page">
            <div class="watermark"><img src="https://brothersegy.com/wp-content/uploads/2026/02/12345.png"></div>
            <div class="page-content">
                <div class="doc-head"><strong>TERMS & CONDITIONS</strong><span>Page 2/4</span></div>
                <div class="terms-grid">
                    <div class="term-p"><span class="term-h">1. CDW INSURANCE</span> Reduces liability. Does NOT cover tires, glass, interior, keys.</div>
                    <div class="term-p"><span class="term-h">2. THEFT</span> Theft is NOT covered. Lessee is responsible.</div>
                    <div class="term-p"><span class="term-h">3. DELIVERY</span> Charges apply out of office hours.</div>
                    <div class="term-p"><span class="term-h">4. ACCIDENTS</span> Must provide Police Report. If at fault, pay repair + downtime.</div>
                    <div class="term-p"><span class="term-h">5. DEPOSIT</span> Refunded upon return if no new damage/fines.</div>
                    <div class="term-p"><span class="term-h">6. AGE</span> Min 21 years old.</div>
                    <div class="term-p"><span class="term-h">7. RETURN</span> 1hr grace period. Late return = Full day charge.</div>
                    <div class="term-p"><span class="term-h">8. CANCELLATION</span> 48h notice required for full refund.</div>
                    <div class="term-p"><span class="term-h">9. INCLUSIONS</span> Breakdown assistance, body repair.</div>
                    <div class="term-p"><span class="term-h">10. EXCLUSIONS</span> Interior, Wrong Fuel, Off-road usage.</div>
                    <div class="term-p"><span class="term-h">11. FINES</span> Lessee pays 100% of traffic fines.</div>
                    <div style="border:1px solid black; padding:3px; font-weight:bold; background:#eee; margin:5px 0;">SELECTED PLAN: ${getVal('ins_type')}</div>
                    <div class="term-p"><span class="term-h">12. PENALTIES</span> Key: 20k, License: 12.5k, Tire: 10k, Interior: 5k+.</div>
                </div>
                <div class="sig-block">I have read and accepted all terms: ________________</div>
            </div>
        </div>`;

        // PAGE 3 (INSPECTION)
        html += `
        <div class="a4-page">
            <div class="watermark"><img src="https://brothersegy.com/wp-content/uploads/2026/02/12345.png"></div>
            <div class="page-content">
                <div class="doc-head"><strong>INSPECTION REPORT</strong><span>Page 3/4</span></div>
                <div class="insp-legend-box">M: Missing | D: Dent | S: Scratch</div>
                <div class="insp-img-box"><img src="https://brothersegy.com/wp-content/uploads/2026/02/تصميم-هيكل-السيارة-للعقود.jpg"></div>
                
                <div class="insp-grid-container">
                    <div class="insp-col col-pass"><h4>PASSENGER</h4><div class="insp-item"><span>Fender F</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Door F</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Door R</span><span class="insp-check">[ ]</span></div></div>
                    <div class="insp-col col-front"><h4>FRONT</h4><div class="insp-item"><span>Bumper</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Hood</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Windsh</span><span class="insp-check">[ ]</span></div></div>
                    <div class="insp-col col-rear"><h4>REAR</h4><div class="insp-item"><span>Trunk</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Bumper</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Lights</span><span class="insp-check">[ ]</span></div></div>
                    <div class="insp-col col-driver"><h4>DRIVER</h4><div class="insp-item"><span>Fender F</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Door F</span><span class="insp-check">[ ]</span></div><div class="insp-item"><span>Door R</span><span class="insp-check">[ ]</span></div></div>
                </div>
                <div class="sig-block">Pickup Signature</div>
                <hr>
                <div class="box-section"><span class="bs-title">RETURN SETTLEMENT</span>
                    <table class="pt"><tr><th>Description</th><th>Cost</th></tr><tr><td>New Damage</td><td></td></tr><tr><td>Fines</td><td></td></tr><tr><td>Total</td><td></td></tr></table>
                </div>
                <div class="sig-block">Return Signature</div>
            </div>
        </div>`;

        // PAGE 4 (RECEIPTS)
        html += '<div class="a4-page"><div class="doc-head"><strong>OFFICIAL RECEIPTS</strong></div><div class="receipts-wrapper">';
        
        // Deposit
        html += `
        <div class="receipt">
            <div class="r-header"><img src="https://brothersegy.com/wp-content/uploads/2025/07/22wdd.jpg" class="r-logo"><div class="r-title">SECURITY DEPOSIT (ON-HOLD)</div><span class="r-copy">CLIENT COPY</span></div>
            <div class="r-body">
                <div class="r-row"><span>Date:</span> <span>${today}</span></div>
                <div class="r-row"><span>Client:</span> <span>${getVal('cl_name')}</span></div>
                <div class="r-row"><span>Car:</span> <span>${getVal('c_model')} | ${getVal('c_plate')}</span></div>
                <div class="r-row"><span>Amount:</span> <b>${d_str}</b></div>
            </div>
            <div class="r-footer"><div class="r-sign">Auth Sig: ______________</div></div>
        </div>`;

        // Rent Loop
        var loop = (mode === 'Monthly') ? months : 1;
        var loopStart = new Date(d1);
        
        for(var i=1; i<=loop; i++) {
            var loopEnd = new Date(loopStart);
            if(mode === 'Monthly') loopEnd.setMonth(loopEnd.getMonth()+1);
            else loopEnd = d2;

            html += `
            <div class="receipt">
                <div class="r-header"><img src="https://brothersegy.com/wp-content/uploads/2025/07/22wdd.jpg" class="r-logo"><div class="r-title">RENTAL PAYMENT RECEIPT</div><span class="r-copy">CLIENT COPY</span></div>
                <div class="r-body">
                    <div class="r-row"><span>Date:</span> <span>${today}</span></div>
                    <div class="r-row"><span>Period:</span> <span>${loopStart.toLocaleDateString()} to ${loopEnd.toLocaleDateString()}</span></div>
                    <div class="r-row"><span>Amount:</span> <b>${i===1 ? r_str : "PENDING"}</b></div>
                </div>
                <div class="r-footer"><div class="r-sign">Auth Sig: ______________</div></div>
            </div>`;
            loopStart = loopEnd;
        }
        
        html += '</div></div>';

        document.getElementById('print-area').innerHTML = html;
        window.print();
    }
</script>
</body>
</html>
